{% extends "base.html" %}
{% block content %}
<a href="{{ url_for('dashboard') }}" class="back-btn">
    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
</a>

<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <!-- Assignment Info -->
        <div class="card mb-4">
            <div class="card-header">
                <div class="row align-items-center">
                    <div class="col">
                        <h2 class="mb-1">{{ assignment.title }}</h2>
                        <p class="text-muted mb-0">{{ assignment.subject }}</p>
                    </div>
                    <div class="col-auto">
                        <span class="badge bg-danger fs-6">
                            <i class="fas fa-calendar me-1"></i>Due: {{ assignment.due_date }}
                        </span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h5>Description</h5>
                        <p class="text-muted">{{ assignment.description }}</p>
                    </div>
                    <div class="col-md-4">
                        {% if assignment.file_path %}
                        <div class="d-grid">
                            <a href="{{ url_for('download_assignment', assignment_id=assignment.id) }}" 
                               class="btn btn-success">
                                <i class="fas fa-download me-2"></i>Download Questions
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        {% if user_type == 'student' %}
        <!-- Submission Section -->
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-upload me-2"></i>Your Submission
                </h4>
            </div>
            <div class="card-body">
                {% if submission %}
                <!-- Existing Submission -->
                <div class="alert alert-success">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-check-circle fa-2x me-3"></i>
                        <div>
                            <h5 class="alert-heading">Assignment Submitted!</h5>
                            <p class="mb-1"><strong>File:</strong> {{ submission.filename }}</p>
                            <p class="mb-0"><strong>Submitted:</strong> {{ submission.upload_date }}</p>
                        </div>
                    </div>
                </div>
                
                {% if submission.ai_score %}
                <!-- AI Evaluation Results -->
                <div class="card mt-3">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-robot me-2"></i>AI Evaluation Results
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3 text-center">
                                <div class="display-4 fw-bold text-primary">{{ submission.ai_score }}</div>
                                <small class="text-muted">out of 100</small>
                            </div>
                            <div class="col-md-9">
                                <h6>Feedback:</h6>
                                <p class="text-muted mb-0">{{ submission.ai_remarks }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% else %}
                <!-- No Submission -->
                <div class="alert alert-warning">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
                        <div>
                            <h5 class="alert-heading">Not Submitted Yet</h5>
                            <p class="mb-0">Submit your assignment before the deadline to avoid penalties.</p>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Upload Form -->
                <div class="card mt-3">
                    <div class="card-header">
                        <h5 class="mb-0">
                            {% if submission %}
                                <i class="fas fa-sync me-2"></i>Update Submission
                            {% else %}
                                <i class="fas fa-upload me-2"></i>Submit Assignment
                            {% endif %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('upload_submission', assignment_id=assignment.id) }}" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="submission-file" class="form-label">Upload Your Answer File</label>
                                <input type="file" class="form-control" id="submission-file" name="file" 
                                       accept=".pdf,.doc,.docx" required>
                                <div class="form-text">
                                    <i class="fas fa-info-circle me-1"></i>Accepted formats: PDF, Word (.doc, .docx)
                                </div>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    {% if submission %}
                                        <i class="fas fa-sync me-2"></i>Update Submission
                                    {% else %}
                                        <i class="fas fa-upload me-2"></i>Submit Assignment
                                    {% endif %}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Submission Guidelines -->
                <div class="card mt-3 bg-light">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="fas fa-info-circle me-2"></i>Submission Guidelines
                        </h6>
                        <ul class="list-unstyled mb-0">
                            <li><i class="fas fa-check text-success me-2"></i>Double-check your answers before submitting</li>
                            <li><i class="fas fa-check text-success me-2"></i>Ensure your file is clearly readable</li>
                            <li><i class="fas fa-check text-success me-2"></i>Submit before the deadline</li>
                            <li><i class="fas fa-check text-success me-2"></i>AI will automatically grade your submission</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}